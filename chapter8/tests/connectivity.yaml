apiVersion: v1
kind: Namespace
metadata:
  name: net-test
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: net-check
  namespace: net-test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: net-check
  template:
    metadata:
      labels:
        app: net-check
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: app
                    operator: In
                    values:
                      - net-check
              topologyKey: kubernetes.io/hostname
      containers:
        - name: agnhost
          image: registry.k8s.io/e2e-test-images/agnhost:2.45
          args:
            - netexec
            - --http-port=8080
            - --udp-port=8081
          ports:
            - containerPort: 8080
              name: http
            - containerPort: 8081
              name: udp
          readinessProbe:
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
          livenessProbe:
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 15
            periodSeconds: 20
---
apiVersion: v1
kind: Service
metadata:
  name: net-check
  namespace: net-test
spec:
  selector:
    app: net-check
  ports:
    - name: http
      port: 80
      targetPort: http
    - name: udp
      port: 81
      targetPort: udp
